<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel='stylesheet' type='text/css' href='/style.css'>
<title>Feed Reader</title>
<body>
<a href=/><h1>Feed Reader</h1></a>
<h2>A place for my favorite people online</h2>
<form id=loginForm method=POST action=/login>
<input placeholder=Username type=email name=user class='pillbox empty'>
<input placeholder=Password type=password name=password class='pillbox empty'>
<input id=login type=submit value='Login' class='pillbox'>
</form>
<p>Great to see you back! I'd love to hear from you, so email me about your favorite shade of blue and why the links should be that color, or about your blog and why it should be on the home page, or just say hi: I'm <a href=mailto:arpith@feedreader.co>arpith@feedreader.co</a> and <a href=http://twitter.com/arpith>@arpith</a> on Twitter.</p>
<div id=feeds>
</div>
<div id=articles>
</div>
</body>
<script>
var current
, token = ''
, user = ''
, form = document.getElementById('loginForm')
, login = document.getElementById('login')
, base64_encode = function(str) {
  return window.btoa(unescape(encodeURIComponent(str)))
}
, api = function(method,endpoint,onload,params) {
  var xhr = new XMLHttpRequest()
  xhr.open(method,'https://api.feedreader.co/v1/'+endpoint)
  xhr.setRequestHeader('authorization','Basic '+base64_encode(token+':'))
  xhr.onload = onload
  if (params) {
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
    xhr.send(params)
  }
  else xhr.send()
}
, get_token = function() {
  user = form.elements["user"].value
  api('POST',user+'/tokens',function(){
    if ((hash = JSON.parse(this.responseText).token)) {
      form.style.display = 'none'
      localStorage.token = hash
      localStorage.user = user
      window.location.pathname = user
    }
    else alert('Please type them out again')
  },"user="+user+"&password="+form.elements["password"].value)
  return false
}
login.onclick = get_token
window.onscroll = mark_as_read
window.onbeforeunload = function() {
  api('DELETE')
}
</script>
